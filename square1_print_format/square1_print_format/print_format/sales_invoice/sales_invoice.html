{# Safe header rendering: - NEVER reference "Sales Invoice Additional Fields" via
frappe.db.exists/get_value (would throw Invalid DocType). - QR is optional; if not available,
header renders without QR. - If the table+column exist, fetch QR via SQL. Otherwise, keep qr_src =
none. #} {% set lang = frappe.form_dict.get('_lang') or '' %} {% if lang in ["العربية", "اردو",
"پارسی"] %} {% set dir = "rtl" %} {% else %} {% set dir = "ltr" %} {% endif %} {% set qr_src = none
%} {# Check table exists (works even if DocType is missing) #} {% set _tbl = frappe.db.sql("SHOW
TABLES LIKE %s", "tabSales Invoice Additional Fields") %} {% if _tbl and (_tbl | len) > 0 %} {#
Check column exists to avoid SQL error #} {% set _col = frappe.db.sql("SHOW COLUMNS FROM `tabSales
Invoice Additional Fields` LIKE %s", "qr_image_src") %} {% if _col and (_col | len) > 0 %} {% set
_qr = frappe.db.sql("SELECT qr_image_src FROM `tabSales Invoice Additional Fields` WHERE
sales_invoice=%s ORDER BY modified DESC LIMIT 1", doc.name) %} {% if _qr and (_qr | len) > 0 and
_qr[0] and _qr[0][0] %} {% set qr_src = _qr[0][0] %} {% endif %} {% endif %} {% endif %}

<!-- Header Container -->
<div
	style="width:100%; display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding-bottom:10px; border-bottom:2px solid #000; direction: {{ dir }};"
>
	<!-- Left: QR Code -->
	<div style="width: 25%; display: flex; justify-content: flex-start; align-items: center">
		{% if qr_src %}
		<img src="{{ qr_src }}" width="100" height="100" style="object-fit: contain" />
		{% endif %}
	</div>

	<!-- Center: Company Logo -->
	<div style="width: 50%; display: flex; justify-content: center; align-items: center">
		<img
			src="{{ frappe.db.get_value('Company', doc.company, 'company_logo') }}"
			alt="{{ doc.company }}"
			style="max-height: 100px; object-fit: contain"
		/>
	</div>

	<!-- Right: Sales Invoice Title & Number -->
	<div
		style="
			width: 25%;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: flex-end;
		"
	>
		<div style="font-size: 16px; font-weight: bold; line-height: 1.2; white-space: nowrap">
			{{ _("SALES INVOICE") }}
		</div>
		<div style="font-size: 12px; margin-top: 2px; white-space: nowrap">{{ doc.name }}</div>
	</div>
</div>
